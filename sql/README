
abbreviations used below:
 - rpwd: root mysql password
 - upwd: user mysql password


One-time setup
==============

  -- Run the commands from this section once
  -- 
  -- Notice that mysql root privileges are required.
  -- No other section requires mysql root privileges.

  -- 1) initialize global database
  mysql -uroot -p<rpwd> < setup_GlobalDB.sql

  -- 2) precreate mysql users
  --
  -- We need to decide how we will get the list of users
  -- and their passwords... through policy?
  -- 
  -- Warning: likely we will need to open remote access 
  -- at least to some domains!

  -- Run this for each user:
  mysql -uroot -p<rpwd> -e 'GRANT ALL ON `<userName>\_%`.* TO `<userName>`@`localhost` IDENTIFIED BY "<upwd>"'
  mysql -uroot -p<rpwd> -e 'GRANT SELECT ON *.* TO `<userName>`@`localhost` IDENTIFIED BY "<upwd>"'
  mysql -uroot -p<rpwd> -e 'GRANT SELECT, INSERT ON GlobalDB.RunInfo_DC3a TO `<userName>`@`localhost` IDENTIFIED BY "<upwd>"'
  mysql -uroot -p<rpwd> -e 'GRANT EXECUTE ON FUNCTION GlobalDB.extendRun TO `<userName>`@`localhost` IDENTIFIED BY "<upwd>"'
  -- The above will authorize everybody to insert runs and extend runs' expiration time.
  -- Notice that users won't be able to hack in and extend runs by calling 'UPDATE' by hand



Per run setup
=============

  -- check available disk space, if too low (say below 10%)
  -- run the cleanupExpiredRuns script (see below), 
  -- if disk space still too low, alert someone and give up


  -- create per run database, using the following naming conventions:
  -- <userName>_<DC version><run number or name>,
  -- for example, jbecla_DC3a_123, smm_DC3a_myTestRun, admin_DC3a_final
  mysql -u<userName> -p<upwd> -e "CREATE DATABASE <dbName>"


  -- Load schema. Use the appropriate schema file:
  -- lsstSchema4mysqlDC3a.sql or lsstSchema4mysqlDC3b.sql 
  mysql -u<userName> -p<upwd> <dbName> < <schema file>


  -- load stored procedures and functions
  mysql -u<userName> -p<upwd> <dbName> < setup_storedFunctions.sql


  -- Load sdqa specific tables
  mysql -u<userName> -p<upwd> <dbName> < setup_sdqa.sql


  -- load run specific contents and tables
  mysql -u<userName> -p<upwd> <dbName> < setup_perRunTables.sql


  -- register this run in the global database
  mysql -u<userName> -p<upwd> GlobalDB -e 'INSERT INTO RunInfo_DC3a (runName, dbName, startDate, expDate, initiator) VALUES ("<runName>", "<dbName>", NOW(), DATE_ADD(NOW(), INTERVAL 2 WEEK), "<userName>")'


Asynchronous
============
 -- run this once per day, preferably at night
 /DMS/cat/???/scripts/cleanExpiredRuns.py root <rpwd>
